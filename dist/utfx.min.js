/*
 utfx (c) 2014 Daniel Wirtz <dcode@dcode.io>
 Released under the Apache License, Version 2.0
 see: https://github.com/dcodeIO/utfx for details
*/
(function(h,f){Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)});var k=f.fromCharCode,e={encodeUTF8:function(a,b){var c=null;"number"===typeof a&&(c=a,a=function(){return null});if("function"!==typeof a||"function"!==typeof b)throw TypeError("Illegal arguments: "+typeof a+", "+typeof b);for(;null!==c||null!==(c=a());)128>c?b(c&127):(2048>c?b(c>>6&31|192):(65536>c?b(c>>12&15|224):(b(c>>18&7|240),b(c>>12&63|128)),b(c>>6&63|128)),b(c&63|128)),c=null},
decodeUTF8:function(a,b){function c(a){throw e.TruncatedError(a.slice(0,a.indexOf(null)));}if("function"!==typeof a||"function"!==typeof b)throw TypeError("Illegal arguments: "+typeof a+", "+typeof b);for(var d,g,f,h;null!==(d=a());)if(0===(d&128))b(d);else if(192===(d&224))null===(g=a())&&c([d,g]),b((d&31)<<6|g&63);else if(224===(d&240))null!==(g=a())&&null!==(f=a())||c([d,g,f]),b((d&15)<<12|(g&63)<<6|f&63);else if(240===(d&248))null!==(g=a())&&null!==(f=a())&&null!==(h=a())||c([d,g,f,h]),b((d&7)<<
18|(g&63)<<12|(f&63)<<6|h&63);else throw RangeError("Illegal starting byte: "+d);},UTF16toUTF8:function(a,b){if("function"!==typeof a||"function"!==typeof b)throw TypeError("Illegal arguments: "+typeof a+", "+typeof b);for(var c,d=null;null!==(c=null!==d?d:a());)55296<=c&&57343>=c&&null!==(d=a())&&56320<=d&&57343>=d?(b(1024*(c-55296)+d-56320+65536),d=null):b(c);null!==d&&b(d)},UTF8toUTF16:function(a,b){var c=null;"number"===typeof a&&(c=a,a=function(){return null});if("function"!==typeof a||"function"!==
typeof b)throw TypeError("Illegal arguments: "+typeof a+", "+typeof b);for(;null!==c||null!==(c=a());)65535>=c?b(c):(c-=65536,b((c>>10)+55296),b(c%1024+56320)),c=null},encodeUTF16toUTF8:function(a,b){if("function"!==typeof b)throw TypeError("Illegal arguments: "+typeof a+", "+typeof b);e.UTF16toUTF8(a,function(a){e.encodeUTF8(a,b)})},decodeUTF8toUTF16:function(a,b){if("function"!==typeof b)throw TypeError("Illegal arguments: "+typeof a+", "+typeof b);e.decodeUTF8(a,function(a){e.UTF8toUTF16(a,b)})},
assertByte:function(a){if("number"!==typeof a||a!==a)throw TypeError("Illegal byte: "+typeof a);if(-128>a||255<a)throw RangeError("Illegal byte: "+a);return a},assertCharCode:function(a){if("number"!==typeof a||a!==a)throw TypeError("Illegal char code: "+typeof a);if(0>a||65535<a)throw RangeError("Illegal char code: "+a);return a},assertCodePoint:function(a){if("number"!==typeof a||a!==a)throw TypeError("Illegal code point: "+typeof a);if(0>a||1114111<a)throw RangeError("Illegal code point: "+a);
return a},calculateCodePoint:function(a){return 128>a?1:2048>a?2:65536>a?3:4},calculateUTF8:function(a){if("function"!==typeof a)throw TypeError("Illegal arguments: "+typeof a);for(var b,c=0;null!==(b=a());)c+=e.calculateCodePoint(b);return c},calculateUTF16asUTF8:function(a){var b=0,c=0;e.UTF16toUTF8(a,function(a){++b;c+=e.calculateCodePoint(a)});return[b,c]},TruncatedError:function(a){if(!(this instanceof e.TruncatedError))return new e.TruncatedError(a);this.name="TruncatedError";this.message=a.join(", ");
this.bytes=a}};e.TruncatedError.prototype=Error();e.arraySource=function(a){if(!Array.isArray(a))throw TypeError("Illegal argument: "+typeof a);var b=0;return function(){return b>=a.length?null:a[b++]}};e.arrayDestination=function(a){if(!Array.isArray(a))throw TypeError("Illegal argument: "+typeof a);return Array.prototype.push.bind(a)};e.stringSource=function(a){if("string"!==typeof a)throw TypeError("Illegal argument: "+typeof a);var b=0;return function(){return b>=a.length?null:a.charCodeAt(b++)}};
e.stringDestination=function(){var a=[],b=[];return function(){if(0===arguments.length)return b.join("")+k.apply(f,a);1024<a.length+arguments.length&&(b.push(k.apply(f,a)),a.length=0);Array.prototype.push.apply(a,arguments)}};e.fromCodePoint=function(a){var b,c=0,d=arguments,f=d.length;e.UTF8toUTF16(function(){return c<f?e.assertCodePoint(d[c++]):null},b=e.stringDestination());return b()};e.codePointAt=function(a,b){if("string"!==typeof a&&!(a&&a instanceof f)||"number"!==typeof b)throw TypeError("Illegal arguments: "+
typeof a+", "+typeof b);var c,d;if(!(0>b||b>=(c=a.length)))return e.UTF16toUTF8(function(){return"undefined"===typeof d&&b<c?a.charCodeAt(b++):null},function(a){d=a}),d};e.polyfill=function(a){if(!f.fromCodePoint||a)f.fromCodePoint=e.fromCodePoint;if(!f.prototype.codePointAt||a)f.prototype.codePointAt=function(a){return e.codePointAt(this,a)};return e};"object"===typeof module&&module&&module.exports?module.exports=e:"function"===typeof define&&define.amd?define(e):(h.dcodeIO||(h.dcodeIO={}),h.dcodeIO.utfx=
e)})(this,String);
