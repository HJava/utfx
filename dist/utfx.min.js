/*
 utfx (c) 2014 Daniel Wirtz <dcode@dcode.io>
 Released under the Apache License, Version 2.0
 see: https://github.com/dcodeIO/utfx for details
*/
(function(h,f){function k(b){var a=0;return function(){return a>=b.length?null:b[a++]}}function l(b){var a=0;return function(){return a>=b.length?null:b.charCodeAt(a++)}}function m(){var b=[],a=Array.prototype.push.bind(b);a._cs=b;return a}var e={},n=f.fromCharCode;e.TruncatedError=function(b){if(!(this instanceof e.TruncatedError))return new e.TruncatedError(b);this.name="TruncatedError";this.message=b.join(", ");this.bytes=b};e.TruncatedError.prototype=Error();e.decodeUTF8=function(b,a){function c(a){throw e.TruncatedError(a.slice(0,
a.indexOf(null)));}"string"===typeof b?b=l(b):Array.isArray(b)&&(b=k(b));Array.isArray(a)&&(a=Array.prototype.push.bind(a));if("function"!==typeof b||"function"!==typeof a)throw TypeError("Illegal arguments: "+typeof b+", "+typeof a);for(var d,g,f,h;null!==(d=b());)if(0===(d&128))a(d);else if(192===(d&224))null===(g=b())&&c([d,g]),a((d&31)<<6|g&63);else if(224===(d&240))null!==(g=b())&&null!==(f=b())||c([d,g,f]),a((d&15)<<12|(g&63)<<6|f&63);else if(240===(d&248))null!==(g=b())&&null!==(f=b())&&null!==
(h=b())||c([d,g,f,h]),a((d&7)<<18|(g&63)<<12|(f&63)<<6|h&63);else throw RangeError("Illegal starting byte: "+d);};e.encodeUTF8=function(b,a){Array.isArray(b)&&(b=k(b));"undefined"===typeof a?a=m():Array.isArray(a)&&(a=Array.prototype.push.bind(a));if("function"!==typeof b||"function"!==typeof a)throw TypeError("Illegal arguments: "+typeof b+", "+typeof a);for(var c;null!==(c=b());){if(0>c||1114111<c)throw RangeError("Illegal code point: "+c);128>c?a(c&2033):(2048>c?a(c>>6&31|192):(65536>c?a(c>>12&
15|224):(a(c>>18&7|240),a(c>>12&63|128)),a(c>>6&63|128)),a(c&63|128))}if(Array.isArray(a._cs))return n.apply(f,a._cs)};e.calculateUTF8=function(b){Array.isArray(b)&&(b=k(b));if("function"!==typeof b)throw TypeError("Illegal arguments: "+typeof b);for(var a,c=0;null!==(a=b());){if(0>a||1114111<a)throw RangeError("Illegal code point: "+a);128>a?++c:c=2048>a?c+2:65536>a?c+3:c+4}return c};e.calculateUTF16asUTF8=function(b){var a=0;e.UTF16toUTF8(b,function(b){if(0>b||1114111<b)throw RangeError("Illegal code point: "+
b);128>b?++a:a=2048>b?a+2:65536>b?a+3:a+4});return a};e.UTF16toUTF8=function(b,a){"string"===typeof b?b=l(b):Array.isArray(b)&&(b=k(b));Array.isArray(a)&&(a=Array.prototype.push.bind(a));if("function"!==typeof b||"function"!==typeof a)throw TypeError("Illegal arguments: "+typeof b+", "+typeof a);for(var c,d=null;;){c=null!==d?d:b();if(null===c)break;if(55296<=c&&57343>=c&&(d=b(),null!==d&&56320<=d&&57343>=d)){a(1024*(c-55296)+d-56320+65536);d=null;continue}a(c)}null!==d&&a(d)};e.UTF8toUTF16=function(b,
a){Array.isArray(b)&&(b=k(b));"undefined"===typeof a?a=m():Array.isArray(a)&&(a=Array.prototype.push.bind(a));if("function"!==typeof b||"function"!==typeof a)throw TypeError("Illegal arguments: "+typeof b+", "+typeof a);var c;for("undefined"===typeof a&&(a=(c=[]).push.bind(c));null!==(c=b());){if(0>c||1114111<c)throw RangeError("Illegal code point: "+c);65535>=c?a(c):(c-=65536,a((c>>10)+55296),a(c%1024+56320))}if(Array.isArray(a._cs))return n.apply(f,a._cs)};e.fromCodePoint=function(b){return e.UTF8toUTF16(Array.prototype.slice.apply(arguments))};
e.codePointAt=function(b,a){var c;e.UTF16toUTF8(function(){return"undefined"===typeof c&&a<b.length?b.charCodeAt(a++):null},function(a){c=a});return c};e.polyfill=function(b){if(!f.fromCodePoint||b)f.fromCodePoint=e.fromCodePoint;if(!f.prototype.codePointAt||b)f.prototype.codePointAt=function(a){return e.codePointAt(this,a)}};"object"===typeof module&&module&&module.exports?module.exports=e:"function"===typeof define&&define.amd?define(e):(h.dcodeIO||(h.dcodeIO={}),h.dcodeIO.utfx=e)})(this,String);
