/*
 utfx (c) 2014 Daniel Wirtz <dcode@dcode.io>
 Released under the Apache License, Version 2.0
 see: https://github.com/dcodeIO/utfx for details
*/
(function(p,g){function l(a){var b=0;return function(){return b>=a.length?null:a[b++]}}function h(a){return Array.prototype.push.bind(a)}function r(a){var b=0;return function(){return b>=a.length?null:a.charCodeAt(b++)}}function m(){var a=[],b=Array.prototype.push.bind(a);b._cs=a;return b}function s(){return null}function q(a){if(0>a||1114111<a)throw RangeError("Illegal code point: "+a);return 128>a?1:2048>a?2:65536>a?3:4}Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)});
var d={},n=g.fromCharCode;d.TruncatedError=function(a){if(!(this instanceof d.TruncatedError))return new d.TruncatedError(a);this.name="TruncatedError";this.message=a.join(", ");this.bytes=a};d.TruncatedError.prototype=Error();d.encodeUTF8=function(a,b){var c=null;"number"===typeof a?(c=a,a=s):Array.isArray(a)&&(a=l(a));"undefined"===typeof b?b=m():Array.isArray(b)&&(b=h(b));if("function"!==typeof a||"function"!==typeof b)throw TypeError("Illegal arguments: "+typeof a+", "+typeof b);for(;null!==c||
null!==(c=a());){if(0>c||1114111<c)throw RangeError("Illegal code point: "+c);128>c?b(c&2033):(2048>c?b(c>>6&31|192):(65536>c?b(c>>12&15|224):(b(c>>18&7|240),b(c>>12&63|128)),b(c>>6&63|128)),b(c&63|128));c=null}if(Array.isArray(b._cs))return n.apply(g,b._cs)};d.decodeUTF8=function(a,b){function c(a){throw d.TruncatedError(a.slice(0,a.indexOf(null)));}"string"===typeof a?a=r(a):Array.isArray(a)&&(a=l(a));Array.isArray(b)&&(b=h(b));if("function"!==typeof a||"function"!==typeof b)throw TypeError("Illegal arguments: "+
typeof a+", "+typeof b);for(var f,e,k,g;null!==(f=a());)if(0===(f&128))b(f);else if(192===(f&224))null===(e=a())&&c([f,e]),b((f&31)<<6|e&63);else if(224===(f&240))null!==(e=a())&&null!==(k=a())||c([f,e,k]),b((f&15)<<12|(e&63)<<6|k&63);else if(240===(f&248))null!==(e=a())&&null!==(k=a())&&null!==(g=a())||c([f,e,k,g]),b((f&7)<<18|(e&63)<<12|(k&63)<<6|g&63);else throw RangeError("Illegal starting byte: "+f);};d.UTF16toUTF8=function(a,b){function c(a){if("number"!==typeof a||a!==a)throw TypeError("Illegal char code: "+
a);if(0>a||65535<a)throw RangeError("Illegal char code: "+d);}"string"===typeof a?a=r(a):Array.isArray(a)&&(a=l(a));Array.isArray(b)&&(b=h(b));if("function"!==typeof a||"function"!==typeof b)throw TypeError("Illegal arguments: "+typeof a+", "+typeof b);for(var d,e=null;null!==(d=null!==e?e:a());){c(d);if(55296<=d&&57343>=d&&null!==(e=a())&&(c(e),56320<=e&&57343>=e)){b(1024*(d-55296)+e-56320+65536);e=null;continue}b(d)}null!==e&&b(e)};d.UTF8toUTF16=function(a,b){var c=null;"number"===typeof a?(c=a,
a=s):Array.isArray(a)&&(a=l(a));"undefined"===typeof b?b=m():Array.isArray(b)&&(b=h(b));if("function"!==typeof a||"function"!==typeof b)throw TypeError("Illegal arguments: "+typeof a+", "+typeof b);for(;null!==c||null!==(c=a());){if("number"!==typeof c||c!==c)throw TypeError("Illegal code point: "+c);if(0>c||1114111<c)throw RangeError("Illegal code point: "+c);65535>=c?b(c):(c-=65536,b((c>>10)+55296),b(c%1024+56320));c=null}if(Array.isArray(b._cs))return n.apply(g,b._cs)};d.encodeUTF16toUTF8=function(a,
b){if("undefined"===typeof b)b=m();else if(Array.isArray(b))b=h(b);else if("function"!==typeof b)throw TypeError("Illegal arguments: "+typeof a+", "+typeof b);d.UTF16toUTF8(a,function(a){d.encodeUTF8(a,b)});if(Array.isArray(b._cs))return n.apply(g,b._cs)};d.decodeUTF8toUTF16=function(a,b){if("undefined"===typeof b)b=m();else if(Array.isArray(b))b=h(b);else if("function"!==typeof b)throw TypeError("Illegal arguments: "+typeof a+", "+typeof b);d.decodeUTF8(a,function(a){d.UTF8toUTF16(a,b)});if(Array.isArray(b._cs))return n.apply(g,
b._cs)};d.calculateUTF8=function(a){if("number"===typeof a)return q(a);Array.isArray(a)&&(a=l(a));if("function"!==typeof a)throw TypeError("Illegal arguments: "+typeof a);for(var b,c=0;null!==(b=a());)c+=q(b);return c};d.calculateUTF16asUTF8=function(a){var b=0;d.UTF16toUTF8(a,function(a){b+=q(a)});return b};d.fromCodePoint=function(a){return d.UTF8toUTF16(Array.prototype.slice.apply(arguments))};d.codePointAt=function(a,b){if("string"!==typeof a&&!(a&&a instanceof g)||"number"!==typeof b)throw TypeError("Illegal arguments: "+
typeof a+", "+typeof b);var c,f;if(!(0>b||b>=(c=a.length)))return d.UTF16toUTF8(function(){return"undefined"===typeof f&&b<c?a.charCodeAt(b++):null},function(a){f=a}),f};d.polyfill=function(a){if(!g.fromCodePoint||a)g.fromCodePoint=d.fromCodePoint;if(!g.prototype.codePointAt||a)g.prototype.codePointAt=function(a){return d.codePointAt(this,a)};return d};"object"===typeof module&&module&&module.exports?module.exports=d:"function"===typeof define&&define.amd?define(d):(p.dcodeIO||(p.dcodeIO={}),p.dcodeIO.utfx=
d)})(this,String);
