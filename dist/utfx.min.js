/*
 utfx (c) 2014 Daniel Wirtz <dcode@dcode.io>
 Released under the Apache License, Version 2.0
 see: https://github.com/dcodeIO/utfx for details
*/
(function(l,g){function n(){return null}function k(){}function m(a){return 128>a?1:2048>a?2:65536>a?3:4}function q(a){if("number"!==typeof a||a!==a)throw TypeError("Illegal code point: "+a);if(0>a||1114111<a)throw RangeError("Illegal code point: "+a);}Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)});var p=g.fromCharCode,e={TruncatedError:function(a){if(!(this instanceof e.TruncatedError))return new e.TruncatedError(a);this.name="TruncatedError";
this.message=a.join(", ");this.bytes=a}};e.TruncatedError.prototype=Error();e.encodeUTF8=function(a,b,c){var d=null;"number"===typeof a&&(d=a,a=n);if(c)c=k;else{if("function"!==typeof a||"function"!==typeof b)throw TypeError("Illegal arguments: "+typeof a+", "+typeof b);c=function(a){if(0>a||1114111<a)throw RangeError("Illegal code point: "+a);}}for(;null!==d||null!==(d=a());)c(d),128>d?b(d&127):(2048>d?b(d>>6&31|192):(65536>d?b(d>>12&15|224):(b(d>>18&7|240),b(d>>12&63|128)),b(d>>6&63|128)),b(d&63|
128)),d=null};e.decodeUTF8=function(a,b,c){function d(a){throw e.TruncatedError(a.slice(0,a.indexOf(null)));}if(!c&&("function"!==typeof a||"function"!==typeof b))throw TypeError("Illegal arguments: "+typeof a+", "+typeof b);for(var f,h,g;null!==(c=a());)if(0===(c&128))b(c);else if(192===(c&224))null===(f=a())&&d([c,f]),b((c&31)<<6|f&63);else if(224===(c&240))null!==(f=a())&&null!==(h=a())||d([c,f,h]),b((c&15)<<12|(f&63)<<6|h&63);else if(240===(c&248))null!==(f=a())&&null!==(h=a())&&null!==(g=a())||
d([c,f,h,g]),b((c&7)<<18|(f&63)<<12|(h&63)<<6|g&63);else throw RangeError("Illegal starting byte: "+c);};e.UTF16toUTF8=function(a,b,c){if(c)c=k;else{if("function"!==typeof a||"function"!==typeof b)throw TypeError("Illegal arguments: "+typeof a+", "+typeof b);c=function(a){if("number"!==typeof a||a!==a)throw TypeError("Illegal char code: "+a);if(0>a||65535<a)throw RangeError("Illegal char code: "+d);}}for(var d,f=null;null!==(d=null!==f?f:a());){c(d);if(55296<=d&&57343>=d&&null!==(f=a())&&(c(f),56320<=
f&&57343>=f)){b(1024*(d-55296)+f-56320+65536);f=null;continue}b(d)}null!==f&&b(f)};e.UTF8toUTF16=function(a,b,c){var d=null;"number"===typeof a&&(d=a,a=n);if(c)c=k;else{if("function"!==typeof a||"function"!==typeof b)throw TypeError("Illegal arguments: "+typeof a+", "+typeof b);c=function(a){if("number"!==typeof a||a!==a)throw TypeError("Illegal code point: "+a);if(0>a||1114111<a)throw RangeError("Illegal code point: "+a);}}for(;null!==d||null!==(d=a());)c(d),65535>=d?b(d):(d-=65536,b((d>>10)+55296),
b(d%1024+56320)),d=null};e.encodeUTF16toUTF8=function(a,b,c){if(!c&&"function"!==typeof b)throw TypeError("Illegal arguments: "+typeof a+", "+typeof b);e.UTF16toUTF8(a,function(a){e.encodeUTF8(a,b,c)},c)};e.decodeUTF8toUTF16=function(a,b,c){if("function"!==typeof b)throw TypeError("Illegal arguments: "+typeof a+", "+typeof b);e.decodeUTF8(a,function(a){e.UTF8toUTF16(a,b,c)},c)};e.calculateUTF8=function(a,b){if("number"===typeof a)return m(a);var c;if(b)c=k;else{if(!b&&"function"!==typeof a)throw TypeError("Illegal arguments: "+
typeof a);c=q}for(var d,e=0;null!==(d=a());)c(d),e+=m(d);return e};e.calculateUTF16asUTF8=function(a,b){var c=0,d=0;e.UTF16toUTF8(a,function(a){++c;d+=m(a)},b);return[c,d]};e.arraySource=function(a,b){if(!b&&!Array.isArray(a))throw TypeError("Illegal argument: "+typeof a);var c=0;return function(){return c>=a.length?null:a[c++]}};e.arrayDestination=function(a,b){if(!b&&!Array.isArray(a))throw TypeError("Illegal argument: "+typeof a);return Array.prototype.push.bind(a)};e.stringSource=function(a,b){if(!b&&
"string"!==typeof a)throw TypeError("Illegal argument: "+typeof a);var c=0;return function(){return c>=a.length?null:a.charCodeAt(c++)}};e.stringDestination=function(){var a=[],b=[];return function(){if(0===arguments.length)return b.join("")+p.apply(g,a);1024<a.length+arguments.length&&(b.push(p.apply(g,a)),a.length=0);Array.prototype.push.apply(a,arguments)}};e.fromCodePoint=function(a){var b;e.UTF8toUTF16(e.arraySource(Array.prototype.slice.apply(arguments)),b=e.stringDestination());return b()};
e.codePointAt=function(a,b){if("string"!==typeof a&&!(a&&a instanceof g)||"number"!==typeof b)throw TypeError("Illegal arguments: "+typeof a+", "+typeof b);var c,d;if(!(0>b||b>=(c=a.length)))return e.UTF16toUTF8(function(){return"undefined"===typeof d&&b<c?a.charCodeAt(b++):null},function(a){d=a}),d};e.polyfill=function(a){if(!g.fromCodePoint||a)g.fromCodePoint=e.fromCodePoint;if(!g.prototype.codePointAt||a)g.prototype.codePointAt=function(a){return e.codePointAt(this,a)};return e};"object"===typeof module&&
module&&module.exports?module.exports=e:"function"===typeof define&&define.amd?define(e):(l.dcodeIO||(l.dcodeIO={}),l.dcodeIO.utfx=e)})(this,String);
